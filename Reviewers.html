<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Top Media Reviewers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Assets/styles/main.css">
    <link rel="stylesheet" href="Assets/styles/cards.css">
    <link rel="stylesheet" href="Assets/styles/navigation.css">
    <link rel="stylesheet" href="Assets/styles/auth.css">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .feed-container {
            max-width: 900px;
            margin: 40px auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 32px #0001;
            padding: 32px 24px;
        }
        .reviewer-card {
            display: flex;
            align-items: center;
            background: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%);
            border-radius: 14px;
            box-shadow: 0 2px 16px #8ec5fc55;
            margin-bottom: 24px;
            padding: 18px 20px;
            transition: box-shadow 0.2s;
        }
        .reviewer-card:hover {
            box-shadow: 0 6px 32px #8ec5fc99;
        }
        .avatar {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 24px;
            background: #eee;
            box-shadow: 0 2px 8px #0002;
        }
        .reviewer-info {
            flex: 1;
        }
        .reviewer-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #4b3f72;
        }
        .reviewer-genres {
            color: #6a89cc;
            font-size: 1em;
            margin-top: 6px;
        }
        .reviewer-stats {
            color: #5a5a5a;
            font-size: 0.95em;
            margin-top: 8px;
        }
        .follow-btn {
            background: #6a89cc;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 18px;
            font-size: 1em;
            cursor: pointer;
            margin-left: 18px;
            transition: background 0.2s;
        }
        .follow-btn:hover {
            background: #4b3f72;
        }
    </style>
</head>
<body>
                <!-- Profile Edit Modal -->
                <div id="profileEditModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
                    <div style="background:#fff; border-radius:12px; max-width:400px; margin:auto; padding:32px; box-shadow:0 4px 32px #0002;">
                        <h2 style="margin-bottom:18px;">Edit Reviewer Profile</h2>
                        <form id="profileEditForm">
                            <label>Name<br><input type="text" id="editName" required style="width:100%;margin-bottom:12px;"></label><br>
                            <label>Genres (comma separated)<br><input type="text" id="editGenres" required style="width:100%;margin-bottom:12px;"></label><br>
                            <label>Avatar URL<br><input type="url" id="editAvatar" style="width:100%;margin-bottom:12px;"></label><br>
                            <label>Bio<br><textarea id="editBio" style="width:100%;margin-bottom:12px;"></textarea></label><br>
                            <button type="submit" style="width:100%;padding:10px 0;background:#6a89cc;color:#fff;border:none;border-radius:8px;font-size:1em;">Save Changes</button>
                            <button type="button" id="closeEditModalBtn" style="width:100%;margin-top:8px;padding:8px 0;background:#eee;color:#333;border:none;border-radius:8px;font-size:1em;">Cancel</button>
                        </form>
                    </div>
                </div>
        <!-- Navigation Bar -->
        <!-- Registration Modal -->
        <div id="registrationModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
            <div style="background:#fff; border-radius:12px; max-width:400px; margin:auto; padding:32px; box-shadow:0 4px 32px #0002;">
                <h2 style="margin-bottom:18px;">Create Reviewer Account</h2>
                <form id="registrationForm">
                    <label>Name<br><input type="text" id="regName" required style="width:100%;margin-bottom:12px;"></label><br>
                    <label>Email<br><input type="email" id="regEmail" required style="width:100%;margin-bottom:12px;"></label><br>
                    <label>Password<br><input type="password" id="regPassword" required style="width:100%;margin-bottom:12px;"></label><br>
                    <label>Genres (comma separated)<br><input type="text" id="regGenres" required style="width:100%;margin-bottom:12px;"></label><br>
                    <label>Profile Picture URL<br><input type="url" id="regAvatarUrl" placeholder="https://example.com/image.jpg" style="width:100%;margin-bottom:12px;"></label><br>
                    <button type="submit" style="width:100%;padding:10px 0;background:#6a89cc;color:#fff;border:none;border-radius:8px;font-size:1em;">Register</button>
                    <button type="button" id="closeModalBtn" style="width:100%;margin-top:8px;padding:8px 0;background:#eee;color:#333;border:none;border-radius:8px;font-size:1em;">Cancel</button>
                </form>
            </div>
        </div>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1 style="cursor:pointer;color:#4b3f72;" id="homeBrand">MediaReview</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="./Assets/Movies/movies.html" class="nav-link">Movies</a></li>
                <li class="nav-item"><a href="#tv" class="nav-link" data-category="tv">TV Shows</a></li>
                <li class="nav-item"><a href="#music" class="nav-link" data-category="music">Music</a></li>
                <li class="nav-item"><a href="#games" class="nav-link" data-category="games">Games</a></li>
                <li class="nav-item"><a href="#books" class="nav-link" data-category="books">Books</a></li>
                <li class="nav-item"><a href="./Reviewers.html" class="nav-link">Reviewers</a></li>
            </ul>
            <div class="auth-buttons">
                <button class="btn btn-login" id="loginBtn">Login</button>
                <button class="btn btn-register" id="registerBtn">Register</button>
                <button class="btn btn-profile" id="profileBtn" style="display:none;">Profile</button>
                <button class="btn btn-logout" id="logoutBtn" style="display:none;">Logout</button>
            </div>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>
    <section class="hero">
        <div class="hero-content">
            <h1>Meet the Top Media Reviewers</h1>
            <p>Browse and follow the best reviewers in movies, TV, music, games, and books. See what they're recommending!</p>
        </div>
    </section>
    <section class="popular-content">
        <div class="container">
            <!-- Login Modal -->
            <div class="modal" id="loginModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Login</h2>
                        <span class="close" data-modal="loginModal">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="loginForm">
                            <div class="form-group">
                                <label for="loginEmail">Email:</label>
                                <input type="email" id="loginEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="loginPassword">Password:</label>
                                <input type="password" id="loginPassword" required>
                            </div>
                            <button type="submit" class="btn btn-primary btn-full">Login</button>
                        </form>
                        <p class="auth-switch">Don't have an account? <a href="#" id="switchToRegister">Register here</a></p>
                    </div>
                </div>
            </div>
            <!-- Register Modal -->
            <div class="modal" id="registerModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Register</h2>
                        <span class="close" data-modal="registerModal">&times;</span>
                    </div>
                    <div class="modal-body">
                        <form id="registerForm">
                            <div class="form-group">
                                <label for="registerUsername">Username:</label>
                                <input type="text" id="registerUsername" required>
                            </div>
                            <div class="form-group">
                                <label for="registerEmail">Email:</label>
                                <input type="email" id="registerEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="registerPassword">Password:</label>
                                <input type="password" id="registerPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Confirm Password:</label>
                                <input type="password" id="confirmPassword" required>
                            </div>
                            <button type="submit" class="btn btn-primary btn-full">Register</button>
                        </form>
                        <p class="auth-switch">Already have an account? <a href="#" id="switchToLogin">Login here</a></p>
                    </div>
                </div>
            </div>
            <div class="feed-container">
                <h2 style="text-align:center; color:#4b3f72;">Top Media Reviewers</h2>
                <!-- Dynamic reviewers from Firestore -->
                <div id="reviewersFeed"></div>
                <script type="module" src="./Assets/scripts/reviewers-follow.js"></script>
                                                <script>
                                                document.addEventListener('DOMContentLoaded', function () {
                                                    var homeBrand = document.getElementById('homeBrand');
                                                    if (homeBrand) {
                                                        homeBrand.onclick = function () {
                                                            window.location.href = 'index.html';
                                                        };
                                                    }
                                                });
                                                </script>
                                <script type="module" src="./Assets/scripts/auth.js"></script>
                                <script type="module">
                                import { auth } from './Assets/scripts/firebase.js';
                                import { signOut } from 'https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js';
                                document.addEventListener('DOMContentLoaded', function () {
                                    const logoutBtn = document.getElementById('logoutBtn');
                                    const profileBtn = document.getElementById('profileBtn');
                                    if (logoutBtn) {
                                        logoutBtn.addEventListener('click', async function () {
                                            await signOut(auth);
                                            window.location.reload();
                                        });
                                    }
                                    if (profileBtn) {
                                        profileBtn.addEventListener('click', function () {
                                            window.location.href = './Assets/profile/index.html';
                                        });
                                    }
                                    import('https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js').then(({ onAuthStateChanged }) => {
                                        onAuthStateChanged(auth, function(user) {
                                            if (user) {
                                                logoutBtn.style.display = '';
                                                profileBtn.style.display = '';
                                            } else {
                                                logoutBtn.style.display = 'none';
                                                profileBtn.style.display = 'none';
                                            }
                                        });
                                    });
                                });
                                </script>
                <button id="becomeReviewerBtn" style="padding:12px 32px; background:#6a89cc; color:#fff; border:none; border-radius:8px; font-size:1.1em; cursor:pointer;">Become a Reviewer</button>
                <script type="module">
                // Show registration modal when 'Become a Reviewer' is clicked
                document.getElementById('becomeReviewerBtn').onclick = function() {
                    document.getElementById('registrationModal').style.display = 'flex';
                };
                // Hide registration modal when 'Cancel' is clicked
                document.getElementById('closeModalBtn').onclick = function() {
                    document.getElementById('registrationModal').style.display = 'none';
                };
                // Handle registration form submission
                document.getElementById('registrationForm').onsubmit = async function(e) {
                    e.preventDefault();
                    const name = document.getElementById('regName').value;
                    const email = document.getElementById('regEmail').value;
                    const password = document.getElementById('regPassword').value;
                    const genres = document.getElementById('regGenres').value;
                    const avatarUrl = document.getElementById('regAvatarUrl').value;
                    // Register user with Firebase Auth
                    try {
                        const { getAuth, createUserWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js');
                        const authInstance = getAuth();
                        const userCredential = await createUserWithEmailAndPassword(authInstance, email, password);
                        const userId = userCredential.user.uid;
                        // Save reviewer profile to Realtime Database
                        const { getDatabase, ref, set } = await import('https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js');
                        const dbInstance = getDatabase();
                        await set(ref(dbInstance, 'reviewers/' + userId), {
                            name,
                            email,
                            genres,
                            avatar: avatarUrl,
                            createdAt: new Date().toISOString()
                        });
                        alert('Reviewer account created!');
                        document.getElementById('registrationModal').style.display = 'none';
                        // Refresh reviewer feed after registration
                        await fetchAndRenderReviewers();
                    } catch (err) {
                        alert('Registration failed: ' + err.message);
                    }
                };

                // Fetch and render reviewers from Firebase Realtime Database
                async function fetchAndRenderReviewers() {
                    const reviewersFeed = document.getElementById('reviewersFeed');
                    reviewersFeed.innerHTML = '<h3 style="color:#6a89cc;margin-top:32px;">Community Reviewers</h3>';
                    try {
                        const { getDatabase, ref, get } = await import('https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js');
                        const appModule = await import('./Assets/scripts/firebase.js');
                        const dbInstance = getDatabase(appModule.app);
                        const snapshot = await get(ref(dbInstance, 'reviewers'));
                        if (snapshot.exists()) {
                            const reviewers = snapshot.val();
                            Object.entries(reviewers).forEach(([userId, reviewer]) => {
                                const card = document.createElement('div');
                                card.className = 'reviewer-card';
                                card.style.cursor = 'pointer';
                                card.innerHTML = `
                                    <img class="avatar" src="${reviewer.avatar || 'https://randomuser.me/api/portraits/lego/1.jpg'}" alt="Reviewer Avatar">
                                    <div class="reviewer-info">
                                        <div class="reviewer-name">${reviewer.name}</div>
                                        <div class="reviewer-genres">Genres: ${reviewer.genres}</div>
                                        <div class="reviewer-stats">Joined: ${new Date(reviewer.createdAt).toLocaleDateString()}</div>
                                    </div>
                                `;
                                card.onclick = () => {
                                    window.location.href = `reviewer-profile.html?id=${userId}`;
                                };
                                reviewersFeed.appendChild(card);
                            });
                        } else {
                            reviewersFeed.innerHTML += '<p>No reviewers have signed up yet.</p>';
                        }
                    } catch (err) {
                        reviewersFeed.innerHTML += '<p>Error loading reviewers.</p>';
                        console.error('Error fetching reviewers:', err);
                    }
                }

                // Initial load of reviewer feed
                fetchAndRenderReviewers();
                </script>
